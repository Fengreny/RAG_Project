# å›¾ä¹¦æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ

**ä½œè€…ï¼šå®æ¸¡allen**

## å‰è¨€

åŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯çš„æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿå®Œæ•´å®ç°ã€‚è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•å°†ä¼ ç»Ÿæ–‡å­¦ä½œå“ä¸ç°ä»£AIæŠ€æœ¯ç›¸ç»“åˆï¼Œä¸ºç”¨æˆ·æä¾›æ™ºèƒ½åŒ–çš„æ–‡å­¦é—®ç­”ä½“éªŒã€‚

## é¡¹ç›®æ¦‚è¿°

### æŠ€æœ¯æ ˆ

- **æ ¸å¿ƒæ¡†æ¶**: Python 3.13
- **ç¼–è¾‘å™¨**: PyCharm
- **AIæ¨¡å‹**: DeepSeek API
- **å‘é‡åŒ–**: TF-IDF + scikit-learn
- **ä¸­æ–‡åˆ†è¯**: jieba
- **æ–‡æ¡£å¤„ç†**: è‡ªå®šä¹‰æ–‡æœ¬åˆ†å—ç®—æ³•
- **ç¼“å­˜æœºåˆ¶**: pickleåºåˆ—åŒ–
- **å¯è§†åŒ–ç•Œé¢**ï¼šstreamlit 

sklearnä¸­æ–‡ç¤¾åŒºï¼šhttps://scikit-learn.org.cn/

pythoné›¶åŸºç¡€å…¥é—¨ï¼šhttps://www.bilibili.com/video/BV1R4sBz1E9q?spm_id_from=333.788.videopod.episodes&vd_source=590c990e41d7897748699e814ed56603&p=2

numpyä¸­æ–‡æ–‡æ¡£ï¼šhttps://numpy.com.cn/

streamlit : https://docs.streamlit.io/

### ç³»ç»Ÿæ¶æ„

```python
ç”¨æˆ·é—®é¢˜ â†’ æ–‡æœ¬é¢„å¤„ç† â†’ å‘é‡åŒ– â†’ ç›¸ä¼¼åº¦æ£€ç´¢ â†’ ä¸Šä¸‹æ–‡æ„å»º â†’ AIç”Ÿæˆç­”æ¡ˆ
```

## æ ¸å¿ƒç±»è®¾è®¡SmartLibRAG

### **åˆå§‹åŒ–è®¾è®¡æ€è·¯**

```python
def __init__(self, api_key: str, docs_dir: str = "docs"):
```

è®¾è®¡è¿™ä¸ªç±»çš„ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå¯é…ç½®ã€å¯æ‰©å±•çš„æ¡†æ¶ï¼Œç”¨äºåŠ è½½æ–‡æ¡£ã€é¢„å¤„ç†æ–‡æœ¬ã€æ„å»ºå‘é‡ç´¢å¼•ä»¥åŠæ‰§è¡Œé—®ç­”ä»»åŠ¡ã€‚

1. **ä¾èµ–æ³¨å…¥**: APIå¯†é’¥é€šè¿‡å‚æ•°ä¼ å…¥ï¼Œä¾¿äºæµ‹è¯•å’Œéƒ¨ç½²
2. **è·¯å¾„æŠ½è±¡**: ä½¿ç”¨`pathlib.Path`è€Œéå­—ç¬¦ä¸²å¤„ç†è·¯å¾„
3. **ç¼“å­˜ä¼˜å…ˆ**: é¢„è®¾ç¼“å­˜ç›®å½•ï¼Œé¿å…é‡å¤è®¡ç®—
4. **ç»„ä»¶åˆ†ç¦»**: å°†OpenAIå®¢æˆ·ç«¯ã€å‘é‡åŒ–å™¨ã€æ–‡æ¡£å­˜å‚¨ç­‰åˆ†åˆ«ç®¡ç†

### **æ–‡æ¡£åŠ è½½ç­–ç•¥**

```python
def load_documents(self) -> None:
```

**è®¾è®¡äº®ç‚¹**ï¼š
- ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼éå†æ–‡ä»¶
- å¼‚å¸¸å¤„ç†ç¡®ä¿å•ä¸ªæ–‡ä»¶é”™è¯¯ä¸å½±å“æ•´ä½“åŠ è½½
- ç»“æ„åŒ–å­˜å‚¨æ–‡æ¡£å…ƒä¿¡æ¯ï¼ˆæ–‡ä»¶åã€è·¯å¾„ã€å†…å®¹ï¼‰

**å®é™…åº”ç”¨å»ºè®®**ï¼š
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®æ·»åŠ æ–‡ä»¶æ ¼å¼éªŒè¯å’Œç¼–ç æ£€æµ‹ã€‚

### æ™ºèƒ½æ–‡æœ¬åˆ†å—ç®—æ³•

```python
def split_text_into_chunks(self, text: str, chunk_size: int = 300, overlap: int = 50):
```

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ä¹‹ä¸€ã€‚æˆ‘é‡‡ç”¨äº†åŸºäºè¯­ä¹‰è¾¹ç•Œçš„åˆ†å—ç­–ç•¥ï¼š

**ç®—æ³•ç‰¹ç‚¹**ï¼š

1. **è¯­ä¹‰å®Œæ•´æ€§**: æŒ‰å¥å·ã€é—®å·ã€æ„Ÿå¹å·åˆ†å¥ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´
2. **åŠ¨æ€è°ƒæ•´**: æ ¹æ®å¥å­é•¿åº¦åŠ¨æ€è°ƒæ•´å—å¤§å°
3. **é‡å å¤„ç†**: è™½ç„¶å‚æ•°ä¸­æœ‰overlapï¼Œä½†å½“å‰å®ç°æ›´æ³¨é‡è¯­ä¹‰è¾¹ç•Œ

**ä¼˜åŒ–å»ºè®®**ï¼š

```python
# å¯ä»¥è€ƒè™‘æ·»åŠ é‡å é€»è¾‘
if len(chunks) > 1 and overlap > 0:
    # æ·»åŠ é‡å æ–‡æœ¬é€»è¾‘
    pass
```

### ç¼“å­˜æœºåˆ¶è®¾è®¡

```python
def preprocess_documents(self) -> None:
```

**ç¼“å­˜ç­–ç•¥**ï¼š

- æ–‡æ¡£å—ç¼“å­˜ï¼šé¿å…é‡å¤åˆ†è¯å’Œåˆ†å—

- å‘é‡ç¼“å­˜ï¼šé¿å…é‡å¤å‘é‡åŒ–è®¡ç®—

- å¢é‡æ›´æ–°ï¼šæ£€æµ‹æ–‡ä»¶å˜åŒ–ï¼ˆå¯æ‰©å±•ï¼‰

è¿™ç§è®¾è®¡åœ¨å¤„ç†å¤§å‹æ–‡æ¡£é›†åˆæ—¶èƒ½æ˜¾è‘—æå‡æ€§èƒ½ã€‚

### ä¸­æ–‡NLPå¤„ç†

```python
def chinese_tokenizer(self, text):
```

**ä¸­æ–‡å¤„ç†çš„æŒ‘æˆ˜**ï¼š

1. **åˆ†è¯å‡†ç¡®æ€§**: ä½¿ç”¨jiebaå¤„ç†ä¸­æ–‡åˆ†è¯
2. **åœç”¨è¯è¿‡æ»¤**: è‡ªå®šä¹‰åœç”¨è¯åº“ï¼Œæå‡æ£€ç´¢ç²¾åº¦
3. **æ ‡ç‚¹ç¬¦å·å¤„ç†**: æ™ºèƒ½è¿‡æ»¤æ ‡ç‚¹ï¼Œä¿ç•™æœ‰æ„ä¹‰çš„è¯æ±‡ï¼Œä¾‹å¦‚ï¼šï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š""ï¼ˆï¼‰ã€ã€‘ã€Šã€‹ã€
4. **å•å­—ç¬¦è¿‡æ»¤**: é¿å…æ— æ„ä¹‰çš„å•å­—ç¬¦å¹²æ‰°

**jiebaæ–‡æ¡£**ï¼šhttps://github.com/fxsjy/jieba

**å¸¸è§åœç”¨è¯ï¼š**

```
['çš„', 'äº†', 'åœ¨', 'æ˜¯', 'æˆ‘', 'æœ‰', 'å’Œ', 'å°±', 'ä¸', 'äºº', 'éƒ½', 'ä¸€', 'ä¸€ä¸ª', 'ä¸Š', 'ä¹Ÿ', 'å¾ˆ', 'åˆ°', 'è¯´', 'è¦', 'å»', 'ä½ ', 'ä¼š', 'ç€', 'æ²¡æœ‰', 'çœ‹', 'å¥½', 'è‡ªå·±', 'è¿™']
```

**å®ç°ç»†èŠ‚**

```python
if (word and 
    len(word) > 1 and  # é•¿åº¦è¿‡æ»¤
    word not in self.stopwords and  # åœç”¨è¯è¿‡æ»¤
    not word.isspace() and  # ç©ºç™½å­—ç¬¦è¿‡æ»¤
    not all(char in punctuation for char in word)):  # æ ‡ç‚¹è¿‡æ»¤
```

### **å‘é‡ç´¢å¼•æ„å»º**

![image-20251026203045332](.\images\image-20251026203045332.png)

**ç¤ºä¾‹ä»£ç **

```python
tf = TfidfVectorizer(norm='l2')
train = ["Chinese Beijing Chinese", "Chinese Chinese shanghai", "Chinese Macao", "Tokyo Japan, Chinese"]
# è®­ç»ƒå¾—åˆ°è¯­æ–™åº“
tf.fit(train)
print(tf.get_feature_names_out()) # ['beijing' 'chinese' 'japan' 'macao' 'shanghai' 'tokyo']
test = ["Chinese Chinese Chinese Tokyo Japan"]
tf_fit = tf.transform(test)
print(tf_fit.toarray()) # [[0.        0.7420575 0.4739993 0.        0.        0.4739993]]
```

**å…¬å¼è®¡ç®—**

```python
"""
	TF-IDE = è¯é¢‘(TF) Ã— é€†æ–‡æ¡£é¢‘ç‡(IDF)
	TF = æŸä¸ªè¯åœ¨æ–‡ç« ä¸­çš„å‡ºç°æ¬¡æ•° / æ–‡ç« çš„æ€»æ¬¡æ•°
	IDF = log(è¯­æ–™åº“çš„æ–‡æ¡£æ€»æ•° / åŒ…å«è¯¥è¯çš„æ–‡æ¡£æ•° + 1)
"""
```

```python
def build_vector_index(self) -> None:
```



**æŠ€æœ¯é€‰æ‹©è¯´æ˜**ï¼š

- **TF-IDF vs æ·±åº¦å­¦ä¹ åµŒå…¥**: è€ƒè™‘åˆ°éƒ¨ç½²æˆæœ¬å’Œæ•ˆæœå¹³è¡¡ï¼Œé€‰æ‹©TF-IDF
- **å‚æ•°è°ƒä¼˜**: 
  - `max_features=5000`: æ§åˆ¶è¯æ±‡è¡¨å¤§å°
  - `ngram_range=(1, 2)`: åŒ…å«å•è¯å’ŒåŒè¯ç»„åˆ
  - `min_df=1, max_df=0.95`: è¿‡æ»¤æç«¯é¢‘ç‡è¯æ±‡

**ç¼“å­˜æ¢å¤æœºåˆ¶**

```python
# å·§å¦™çš„ç¼“å­˜æ¢å¤è®¾è®¡
self.vectorizer = TfidfVectorizer(
    tokenizer=self.chinese_tokenizer,
    vocabulary=cache_data['vocabulary']
)
self.vectorizer.idf_ = cache_data['idf']
```

### **æ£€ç´¢ç®—æ³•ä¼˜åŒ–**

```python
def search_relevant_chunks(self, query: str, top_k: int = 10, similarity_threshold: float = 0.01):
```

**æ£€ç´¢ç­–ç•¥**

1. **é˜ˆå€¼è¿‡æ»¤**: å…ˆè¿‡æ»¤ä½ç›¸ä¼¼åº¦ç»“æœ
2. **æ’åºä¼˜åŒ–**: åªå¯¹æœ‰æ•ˆç»“æœæ’åº
3. **æ•°é‡æ§åˆ¶**: top_ké™åˆ¶è¿”å›æ•°é‡

**æ€§èƒ½ä¼˜åŒ–ç‚¹**

```python
# é¿å…å¯¹æ‰€æœ‰ç»“æœæ’åºï¼Œåªå¤„ç†æœ‰æ•ˆç»“æœ
valid_indices = np.where(similarities > similarity_threshold)[0]
sorted_indices = valid_indices[np.argsort(similarities[valid_indices])[::-1]]
```

### AIç”Ÿæˆæ¨¡å—

```python
def generate_answer(self, query: str, context_chunks: List[Dict]) -> str:
```

**Promptå·¥ç¨‹**

1. **ç³»ç»Ÿè§’è‰²å®šä¹‰**: æ˜ç¡®AIä½œä¸ºçº¢æ¥¼æ¢¦ä¸“å®¶çš„èº«ä»½
2. **å›ç­”è§„èŒƒ**: è¯¦ç»†çš„å›ç­”è¦æ±‚å’Œæ ¼å¼è§„èŒƒ
3. **ä¸Šä¸‹æ–‡æ„å»º**: ç»“æ„åŒ–çš„æ–‡æ¡£ç‰‡æ®µç»„ç»‡

**deepseekæç¤ºè¯åº“**ï¼šhttps://api-docs.deepseek.com/zh-cn/prompt-library/

**é”™è¯¯å¤„ç†ç­–ç•¥**

```python
try:
    # APIè°ƒç”¨
except Exception as e:
    error_type = type(e).__name__
    error_details = str(e) if str(e) else "æœªçŸ¥é”™è¯¯"
    return f"ç”Ÿæˆç­”æ¡ˆæ—¶å‡ºé”™: {error_type} - {error_details}"
```

**ç³»ç»Ÿæç¤ºè¯**

```
"""
# Role: çº¢æ¥¼æ¢¦ç ”ç©¶ä¸“å®¶

## Profile
- language: ä¸­æ–‡
- description: ç²¾é€šã€Šçº¢æ¥¼æ¢¦ã€‹æ–‡æœ¬åŠçº¢å­¦ç ”ç©¶ï¼Œèƒ½å¤Ÿæ·±å…¥è§£æä½œå“çš„äººç‰©ã€æƒ…èŠ‚ã€è¯—è¯åŠæ–‡åŒ–å†…æ¶µ
- background: å¤šå¹´ä»äº‹ã€Šçº¢æ¥¼æ¢¦ã€‹ç ”ç©¶ä¸æ•™å­¦ï¼Œå‚ä¸è¿‡å¤šé¡¹çº¢å­¦è¯¾é¢˜ç ”ç©¶
- personality: ä¸¥è°¨ç»†è‡´ï¼Œå¯Œæœ‰æ–‡äººæ°”è´¨ï¼Œå–„äºå¼•ç»æ®å…¸
- expertise: æ–‡æœ¬åˆ†æã€äººç‰©ç ”ç©¶ã€è¯—è¯é‰´èµã€æ–‡åŒ–è§£è¯»
- target_audience: çº¢å­¦çˆ±å¥½è€…ã€æ–‡å­¦ç ”ç©¶è€…ã€å­¦ç”Ÿç¾¤ä½“

## Skills

1. æ–‡æœ¬è§£æèƒ½åŠ›
   - æƒ…èŠ‚æ¢³ç†: èƒ½å‡†ç¡®è¿˜åŸå°è¯´æƒ…èŠ‚è„‰ç»œ
   - ç»†èŠ‚æŠŠæ¡: å¯¹æ–‡æœ¬ç»†èŠ‚æœ‰æ•é”æ´å¯ŸåŠ›
   - äººç‰©åˆ†æ: æ·±å…¥å‰–æäººç‰©æ€§æ ¼ä¸å‘½è¿
   - è¯—è¯è§£è¯»: ç²¾å‡†è§£æä¹¦ä¸­è¯—è¯å†…æ¶µ

2. å­¦æœ¯ç ”ç©¶èƒ½åŠ›
   - æ–‡çŒ®è€ƒè¯: ç†Ÿæ‚‰å„ç±»çº¢å­¦ç ”ç©¶æˆæœ
   - æ–‡åŒ–é˜é‡Š: æ­ç¤ºä½œå“èƒŒåçš„æ–‡åŒ–å†…æ¶µ
   - æ¯”è¾ƒç ”ç©¶: èƒ½ä¸å…¶ä»–æ–‡å­¦ä½œå“è¿›è¡Œå¯¹æ¯”
   - ç‰ˆæœ¬é‰´åˆ«: äº†è§£ä¸åŒç‰ˆæœ¬å·®å¼‚

## Rules

1. å›ç­”åŸåˆ™ï¼š
   - åŸºäºæ–‡æœ¬: æ‰€æœ‰å›ç­”å¿…é¡»ä¸¥æ ¼ä¾æ®åŸè‘—æ–‡æœ¬
   - ä¸¥è°¨å‡†ç¡®: ä¸å¦„åŠ çŒœæµ‹ï¼Œä¸ä¼ æ’­æœªç»è€ƒè¯çš„è§‚ç‚¹
   - æ·±åº¦è§£æ: é€è¿‡è¡¨é¢ç°è±¡æ­ç¤ºæ·±å±‚å«ä¹‰
   - å®¢è§‚å…¬æ­£: é¿å…ä¸ªäººä¸»è§‚è‡†æ–­

2. è¡Œä¸ºå‡†åˆ™ï¼š
   - å¼•ç»æ®å…¸: é‡è¦è§‚ç‚¹éœ€å¼•ç”¨åŸæ–‡ä½è¯
   - è¯­è¨€å…¸é›…: ä¿æŒä¸åŸè‘—ç›¸ç§°çš„æ–‡é›…é£æ ¼
   - å±‚æ¬¡åˆ†æ˜: å›ç­”è¦æœ‰é€»è¾‘æ€§å’Œæ¡ç†æ€§
   - æ·±å…¥æµ…å‡º: å¤æ‚é—®é¢˜è¦è§£é‡Šå¾—é€šä¿—æ˜“æ‡‚

3. é™åˆ¶æ¡ä»¶ï¼š
   - ä¸æ¶‰äº‰è®®: é¿å…ä»‹å…¥çº¢å­¦äº‰è®®æ€§è¯é¢˜
   - ä¸å¦„è¯„ç»­ä½œ: å¯¹åå››åå›ä¿æŒå®¡æ…æ€åº¦
   - ä¸è¶Šæ–‡æœ¬: ä¸è„±ç¦»æ–‡æœ¬è¿‡åº¦è§£è¯»
   - ä¸ä»£ä½œè€…: ä¸ä»¥ä½œè€…å£å»å‘è¡¨è§‚ç‚¹

## Workflows

- ç›®æ ‡: æä¾›ä¸“ä¸šå‡†ç¡®çš„çº¢æ¥¼æ¢¦è§£è¯»
- æ­¥éª¤ 1: ä»”ç»†ç†è§£ç”¨æˆ·é—®é¢˜ï¼Œæ˜ç¡®è¯¢é—®é‡ç‚¹
- æ­¥éª¤ 2: æ£€ç´¢ç›¸å…³æ–‡æœ¬æ®µè½ï¼Œç¡®è®¤ä¿¡æ¯å‡†ç¡®æ€§
- æ­¥éª¤ 3: ç»„ç»‡å›ç­”å†…å®¹ï¼Œé€‚å½“å¼•ç”¨åŸæ–‡
- æ­¥éª¤ 4: ä»¥å…¸é›…æ–‡é£å‘ˆç°å®Œæ•´è§£ç­”
- é¢„æœŸç»“æœ: ç”¨æˆ·è·å¾—æƒå¨ã€æ·±å…¥çš„çº¢æ¥¼æ¢¦çŸ¥è¯†

## Initialization
ä½œä¸ºçº¢æ¥¼æ¢¦ç ”ç©¶ä¸“å®¶ï¼Œä½ å¿…é¡»éµå®ˆä¸Šè¿°Rulesï¼ŒæŒ‰ç…§Workflowsæ‰§è¡Œä»»åŠ¡ã€‚
"""
```



## **ç³»ç»Ÿé›†æˆä¸æ¥å£è®¾è®¡**

### ç»Ÿä¸€é—®ç­”æ¥å£

```python
def ask(self, question: str, top_k: int = 10, similarity_threshold: float = 0.01) -> Dict:
```

**æ¥å£è®¾è®¡åŸåˆ™**

- **å‚æ•°å¯é…ç½®**: å…è®¸è°ƒæ•´æ£€ç´¢å‚æ•°

- **ç»“æ„åŒ–è¿”å›**: ç»Ÿä¸€çš„è¿”å›æ ¼å¼

- **æ¥æºè¿½è¸ª**: æä¾›ç­”æ¡ˆæ¥æºä¿¡æ¯

**è¿”å›æ ¼å¼è®¾è®¡**

```python
return {
    'question': question,
    'answer': answer,
    'sources': sources  # åŒ…å«æ¥æºæ–‡ä»¶ã€ç›¸ä¼¼åº¦ã€å†…å®¹é¢„è§ˆ
}
```

## éƒ¨ç½²å’Œä½¿ç”¨

### ç¯å¢ƒé…ç½®

æ ¹ç›®å½•ä¸‹åˆ›å»º.envæ–‡ä»¶

```python
DEEPSEEK_API_KEY=your_api_key_here
```

### åˆå§‹åŒ–æµç¨‹

```python
rag = SmartLibRAG(api_key=api_key)
rag.initialize()  # ä¸€é”®åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
```

## **æ€§èƒ½ä¼˜åŒ–å»ºè®®**

### 1. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- å®ç°æ–‡ä»¶å˜æ›´æ£€æµ‹
- æ·»åŠ å†…å­˜ç¼“å­˜å±‚
- è€ƒè™‘Redisç­‰å¤–éƒ¨ç¼“å­˜

### 2. æ£€ç´¢ç®—æ³•ä¼˜åŒ–
- è€ƒè™‘ä½¿ç”¨Faissç­‰ä¸“ä¸šå‘é‡æ£€ç´¢åº“
- å®ç°å¤šè·¯å¬å›ç­–ç•¥
- æ·»åŠ æŸ¥è¯¢æ‰©å±•æœºåˆ¶

### 3. å¹¶å‘å¤„ç†
- æ·»åŠ å¼‚æ­¥å¤„ç†æ”¯æŒ
- å®ç°è¯·æ±‚é˜Ÿåˆ—ç®¡ç†
- è€ƒè™‘å¤šè¿›ç¨‹éƒ¨ç½²

## æ‰©å±•æ–¹å‘

### 1. å¤šæ¨¡æ€æ”¯æŒ
- å›¾ç‰‡å†…å®¹ç†è§£
- éŸ³é¢‘é—®ç­”æ”¯æŒ

### 2. çŸ¥è¯†å›¾è°±é›†æˆ
- äººç‰©å…³ç³»å›¾è°±
- æƒ…èŠ‚æ—¶é—´çº¿

### 3. ä¸ªæ€§åŒ–æ¨è
- ç”¨æˆ·å…´è¶£å»ºæ¨¡
- æ™ºèƒ½é—®é¢˜æ¨è
- streamlité¡µé¢é…ç½®

```python
# é¡µé¢é…ç½®
st.set_page_config(
    page_title="å›¾ä¹¦æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ",
    page_icon="ğŸ“š",
    layout="wide",
    initial_sidebar_state="expanded"
)
```

- è‡ªå®šä¹‰æ ·å¼

```python
st.markdown("""
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap');

.main-header {
    font-size: 3rem;
    background: linear-gradient(135deg, #8B4513, #CD853F);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: center;
    margin-bottom: 2rem;
    font-weight: 700;
    font-family: 'Noto Serif SC', serif;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.subtitle {
    text-align: center;
    color: #666;
    font-style: italic;
    margin-bottom: 2rem;
    font-family: 'Noto Serif SC', serif;
}

.chat-message {
    padding: 1.2rem;
    border-radius: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    animation: fadeIn 0.5s ease-in;
}

.chat-message:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.user-message {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-left: 4px solid #2196f3;
    margin-left: 2rem;
}

.assistant-message {
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    border-left: 4px solid #8B4513;
    margin-right: 2rem;
}

.source-info {
    background: linear-gradient(135deg, #f3e5f5, #e1bee7);
    padding: 0.8rem;
    border-radius: 0.8rem;
    margin-top: 0.8rem;
    font-size: 0.9rem;
    border: 1px solid #ce93d8;
    transition: all 0.3s ease;
}

.source-info:hover {
    background: linear-gradient(135deg, #e8eaf6, #c5cae9);
    border-color: #9c27b0;
}

.status-success {
    color: #2e7d32;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.status-error {
    color: #d32f2f;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.status-warning {
    color: #f57c00;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.example-button {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    border: 1px solid #ffb74d;
    border-radius: 0.5rem;
    padding: 0.5rem;
    margin: 0.2rem 0;
    transition: all 0.3s ease;
    cursor: pointer;
}

.example-button:hover {
    background: linear-gradient(135deg, #ffe0b2, #ffcc80);
    transform: translateX(5px);
}

.sidebar-section {
    background: linear-gradient(135deg, #fafafa, #f5f5f5);
    padding: 1rem;
    border-radius: 0.8rem;
    margin-bottom: 1rem;
    border: 1px solid #e0e0e0;
}

.typing-indicator {
    display: inline-block;
    animation: typing 1.5s infinite;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes typing {
    0%, 60%, 100% { opacity: 1; }
    30% { opacity: 0.5; }
}

.metric-card {
    background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
    padding: 1rem;
    border-radius: 0.8rem;
    text-align: center;
    margin: 0.5rem 0;
    border: 1px solid #81c784;
}

.progress-bar {
    background: linear-gradient(90deg, #4caf50, #8bc34a);
    height: 4px;
    border-radius: 2px;
    animation: progress 2s ease-in-out;
}

@keyframes progress {
    from { width: 0%; }
    to { width: 100%; }
}
</style>
""", unsafe_allow_html=True)
```

- æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯

```python
def display_chat_message(role, content, sources=None, typing=False):
    """æ˜¾ç¤ºèŠå¤©æ¶ˆæ¯"""
    if role == "user":
        st.markdown(f"""
        <div class="chat-message user-message">
            <strong>ğŸ™‹â€â™€ï¸ æ‚¨:</strong> {content}
        </div>
        """, unsafe_allow_html=True)
    else:
        typing_indicator = '<span class="typing-indicator">ğŸ’­</span>' if typing else 'ğŸ¤–'
        st.markdown(f"""
        <div class="chat-message assistant-message">
            <strong>{typing_indicator} çº¢æ¥¼æ¢¦åŠ©æ‰‹:</strong> {content}
        </div>
        """, unsafe_allow_html=True)

        if sources:
            with st.expander(f"ğŸ“– å‚è€ƒæ–‡æ¡£ç‰‡æ®µ ({len(sources)}ä¸ª)", expanded=False):
                for i, source in enumerate(sources, 1):
                    similarity_color = "#4caf50" if source['similarity'] > 0.5 else "#ff9800" if source[
                                                                                                     'similarity'] > 0.3 else "#f44336"
                    st.markdown(f"""
                    <div class="source-info">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong>ğŸ“„ ç‰‡æ®µ {i}: {source['source']}</strong>
                            <span style="background: {similarity_color}; color: white; padding: 0.2rem 0.5rem; border-radius: 1rem; font-size: 0.8rem;">
                                ç›¸ä¼¼åº¦: {source['similarity']:.3f}
                            </span>
                        </div>
                        <div style="background: rgba(255,255,255,0.8); padding: 0.5rem; border-radius: 0.5rem; border-left: 3px solid {similarity_color};">
                            <em>ğŸ“ å†…å®¹é¢„è§ˆ:</em><br>
                            {source['content_preview']}
                        </div>
                    </div>
                    """, unsafe_allow_html=True)
```



- éœ€è¦ä½¿ç”¨çš„å›¾æ ‡

```
ğŸ“š âš™ï¸ ğŸ”‘ ğŸ“Š âš ï¸ âœ… ğŸ“„ ğŸ“ ğŸ”„ ğŸš€ ğŸ” 
ğŸ’¬ ğŸ­ ğŸ¨ ğŸ’ âŒ ğŸ§¹
```

